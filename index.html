<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BloxGlobe Dashboard</title>

  <!-- Correct CSS path -->
  <link rel="stylesheet" href="src/assets/styles/global.css" />

  <!-- Compiled Tailwind build -->
<link rel="stylesheet" href="dist/output.css">
</head>

<body class="bg-gray-900 text-white">

  <div class="flex h-screen">

    <!-- Sidebar -->
    <aside class="w-64 bg-gray-800 p-5 flex flex-col gap-3">
      <h1 class="text-xl font-bold mb-4">Dashboard</h1>

      <button class="nav-btn block w-full text-left px-3 py-2 rounded hover:bg-gray-700" data-page="home">Home</button>
      <button class="nav-btn block w-full text-left px-3 py-2 rounded hover:bg-gray-700" data-page="experience">Experiences</button>
      <button class="nav-btn block w-full text-left px-3 py-2 rounded hover:bg-gray-700" data-page="ugc">UGC Clothing</button>

      <!-- Forums -->
      <button class="nav-btn block w-full text-left px-3 py-2 rounded hover:bg-gray-700" data-page="feedback">Forums</button>

      <!-- Game Updates -->
      <button class="nav-btn block w-full text-left px-3 py-2 rounded hover:bg-gray-700" data-page="site">Game Updates</button>

      <button class="nav-btn block w-full text-left px-3 py-2 rounded hover:bg-gray-700" data-page="setting">Settings</button>
    </aside>

    <!-- Main Content -->
    <main id="app" class="flex-1 flex flex-col overflow-y-auto">

      <!-- Dynamic Page Content -->
      <div id="page-content" class="p-6">
        Loading...
      </div>

      <!-- FOOTER -->
      <footer class="mt-auto py-4 text-center opacity-60 text-sm border-t border-gray-700">
        © <span id="year"></span> BloxGlobe — All rights reserved.
      </footer>

    </main>

  </div>

<!-- *****************************************************
     PAGE LOADER SCRIPT
****************************************************** -->
<script>
(function(){
  const app = document.getElementById('page-content');

  async function loadPage(page){
    try{
      const res = await fetch(`src/pages/${page}.html`);
      if(!res.ok) throw new Error("Page not found");

      const html = await res.text();
      app.innerHTML = html;

      document.querySelectorAll('.nav-btn')
        .forEach(btn => btn.classList.remove('bg-gray-700'));

      const active = document.querySelector(`.nav-btn[data-page="${page}"]`);
      if(active) active.classList.add('bg-gray-700');

      history.replaceState({page: page}, '', `#${page}`);

    } catch(err){
      load404();
    }
  }

  async function load404(){
    const res = await fetch(`src/pages/404.html`);
    app.innerHTML = await res.text();
  }

  document.querySelectorAll('.nav-btn').forEach(btn => {
    btn.addEventListener('click', () => loadPage(btn.dataset.page));
  });

  const initial = location.hash ? location.hash.slice(1) : 'home';
  loadPage(initial);

  window.addEventListener('popstate', (e)=>{
    const page = (e.state && e.state.page) || location.hash.slice(1) || 'home';
    loadPage(page);
  });

  document.getElementById("year").textContent = new Date().getFullYear();
})();
</script>

<!-- *****************************************************
     SECURITY PROMPT INTEGRATION
****************************************************** -->
<script type="module">
  import { openSecurityPrompt } from "./packages/Oauth/securityPrompt.ts";

  document.addEventListener("click", (e) => {
    const target = e.target;

    if (target && target.id === "postUpdateBtn") {
      openSecurityPrompt(() => {

        const input = document.getElementById("updateInput");
        const log = document.getElementById("changelog");

        if (!input.value.trim()) return;

        log.innerHTML = `<div class='mb-2'>• ${input.value}</div>` + log.innerHTML;
        input.value = "";
      });
    }
  });
</script>

<script src="router.js"></script>

</body>
</html>
